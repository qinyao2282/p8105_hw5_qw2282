p8105\_hw5\_qw2282
================
Qinyao Wu
11/1/2018

### Problem 1

``` r
data_longitudinal = data_frame(filename = list.files("./data")) %>%
  filter(!filename == "homicide-data.csv") %>% 
  mutate(file_contents = map(filename, ~read_csv(file.path("./data", . )))) %>% 
  unnest() %>% 
  separate(filename, into = c("group", "subject"), sep = "_") %>% 
  separate(subject, into = c("subject", "delete")) %>% 
  select(-delete) %>% 
  janitor::clean_names() %>% 
  mutate(subject = factor(subject), group = factor(group)) %>% 
  gather(key = week, value = number, week_1:week_8) %>% 
  separate(week, into = c("delete", "week"), sep = "_") %>% 
  select(-delete) %>% 
  mutate(week = as.numeric(week))


ggplot(data_longitudinal, aes(x = week, y = number, group = (group:subject), color = group)) +
  geom_point() +
  geom_line() +
  labs(
    title = "Observation of Longitudinal Studies",
    x = "Weeks",
    
    y = "Observations"
  )
```

![](p8105_hw5_qw2282_files/figure-markdown_github/unnamed-chunk-1-1.png)

### Problem 2

``` r
data_homicide = read.csv(file = "./data/homicide-data.csv") %>% 
  mutate(city_state = str_c(city,", ", state)) %>% 
  select(-city, -state) 


check_arrest = function(disposition) {
  
  if (disposition == "Closed by arrest") {
     "arrested"
  } else  {
     "unarrested"
  }
}


total_number_homicide = 
  data_homicide %>% 
  mutate(arrest_stage = as.character(map(disposition, check_arrest))) %>% 
  
  group_by(city_state, arrest_stage) %>% 
  summarize(total_number = n()) %>% 
  spread(key = arrest_stage, value = total_number) %>% 
  replace(is.na(.), 0) %>% 
  mutate(total_number = arrested + unarrested) 
  

baltimore_data = total_number_homicide %>% 
  filter(city_state == "Baltimore, MD") 

output = prop.test(baltimore_data$unarrested, baltimore_data$total_number) %>% 
  broom::tidy() %>% 
  select(estimate, conf.low, conf.high)
```

``` r
calculate_proportion = function(data) {
  output = prop.test(data$unarrested, data$total_number) %>% 
  broom::tidy() %>% 
  select(estimate, conf.low, conf.high)
  
  output
}



estimation_for_city = total_number_homicide %>% 
  nest(city_state, arrested:total_number) %>% 
  mutate(proportion = map(data, calculate_proportion)) %>% 
  unnest()
```

    ## Warning in prop.test(data$unarrested, data$total_number): Chi-squared
    ## approximation may be incorrect

Make the plot

``` r
estimation_for_city %>% 
  mutate(city_state = forcats::fct_reorder(factor(city_state), unarrested/total_number)) %>% 
  ggplot(aes(x = city_state, y = unarrested/total_number)) +
  geom_point(size = 4, shape = 21, fill="white") +
  geom_errorbar(aes(x = city_state, ymin = conf.low, ymax = conf.high)) +
  theme(text = element_text(size = 6), axis.text.x = element_text(angle = 60, hjust = 1)) + 
  labs(
    title = "Estimation for Unsolved Homicides",
    x = "City State",
    y = "Estimation of unsolved homicides"
  )
```

![](p8105_hw5_qw2282_files/figure-markdown_github/unnamed-chunk-4-1.png)
